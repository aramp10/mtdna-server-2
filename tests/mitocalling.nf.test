nextflow_pipeline {

    name "Test Workflow main.nf"
    script "main.nf"
    
    test("Runs with single BAM file and mutserve") {

        when {
            params {
               project = "test-job"
               files = "$projectDir/tests/data/bam/*.bam"
               mode = "mutserve"
               output = "out"
               output_reports = "reports"
               output_auxiliary = "files"
            }
        }

        then {
            assert workflow.success
            assert snapshot(path("${launchDir}/out/variants_ann.txt")).match()
        }

    }

        test("Runs with single BAM file and mutect2") {

        when {
            params {
               project = "test-job"
               files = "$projectDir/tests/data/bam/*.bam"
               mode = "mutect2"
               output = "out"
               output_reports = "reports"
               output_auxiliary = "files"
            }
        }

        then {
            assert workflow.success
            //TODO: sort variants file by sample after merging to get a deterministic order
            //assert snapshot(path("${launchDir}/out/variants_ann.txt")).match()
        }

    }

}